<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            transition: all 0.3s ease-in-out;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .image-container {
            width: 100%;
            max-width: 640px;
            aspect-ratio: 16 / 9;
            background-color: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }
        #generated-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #6366f1;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            color: #4b5563;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        /* Custom styling for color input to match theme */
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }
        /* Responsive aspect ratio for the image container */
        @media (max-width: 768px) {
            .image-container {
                aspect-ratio: 4 / 3;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container p-4">
        <div class="w-full max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl p-8 flex flex-col items-center space-y-8">
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">Generate an Image from Text</h1>

            <!-- User input for the text prompt -->
            <div class="w-full">
                <label for="user-input" class="block text-sm font-medium text-gray-700 mb-2">Enter your text:</label>
                <textarea id="user-input" rows="4" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-4 transition-colors" placeholder="e.g., 'A clean, modern, digital art style image with bold typography...'"></textarea>
            </div>
            
            <!-- Formatting options -->
            <div class="w-full grid grid-cols-2 gap-6 md:grid-cols-4">
                <div>
                    <label for="font-family" class="block text-sm font-medium text-gray-700">Font Family:</label>
                    <select id="font-family" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                        <option value="Inter">Inter</option>
                        <option value="Poppins">Poppins</option>
                        <option value="Montserrat">Montserrat</option>
                        <option value="Lora">Lora</option>
                        <option value="Oswald">Oswald</option>
                        <option value="Playfair Display">Playfair Display</option>
                    </select>
                </div>
                <div>
                    <label for="text-style" class="block text-sm font-medium text-gray-700">Text Style:</label>
                    <select id="text-style" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                        <option value="paragraph">Paragraph</option>
                        <option value="subheading">Subheading</option>
                        <option value="heading">Heading</option>
                    </select>
                </div>
                <div>
                    <label for="text-color" class="block text-sm font-medium text-gray-700">Text Color:</label>
                    <input type="color" id="text-color" value="#1f2937" class="mt-1 block w-full h-10 rounded-xl border-gray-300 shadow-sm">
                </div>
                <div>
                    <label for="background-mode" class="block text-sm font-medium text-gray-700">Background:</label>
                    <select id="background-mode" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                        <option value="color">Solid Color</option>
                        <option value="image">Uploaded Image</option>
                    </select>
                </div>
            </div>

            <!-- New formatting options for text placement and alignment -->
            <div class="w-full grid grid-cols-2 gap-6">
                <div>
                    <label for="text-placement" class="block text-sm font-medium text-gray-700">Text Placement:</label>
                    <select id="text-placement" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                        <option value="top">Top</option>
                        <option value="middle" selected>Middle</option>
                        <option value="bottom">Bottom</option>
                    </select>
                </div>
                <div>
                    <label for="text-align" class="block text-sm font-medium text-gray-700">Text Alignment:</label>
                    <select id="text-align" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                        <option value="left">Left</option>
                        <option value="center" selected>Center</option>
                        <option value="right">Right</option>
                    </select>
                </div>
            </div>
            
            <!-- Image Dimension Options -->
            <div class="w-full">
                <label for="image-dimensions" class="block text-sm font-medium text-gray-700">Image Dimensions:</label>
                <select id="image-dimensions" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm sm:text-sm p-2 transition-colors">
                    <option value="default">Default (640x480)</option>
                    <option value="1080x1350">1080 x 1350</option>
                    <option value="fit-to-image">Fit to Background Image</option>
                </select>
            </div>

            <!-- Conditional background inputs -->
            <div id="background-options" class="w-full mt-4">
                <div id="color-picker-container">
                    <label for="bg-color" class="block text-sm font-medium text-gray-700 mb-2">Background Color:</label>
                    <input type="color" id="bg-color" value="#e5e7eb" class="mt-1 block w-full h-10 rounded-xl border-gray-300 shadow-sm">
                </div>
                <div id="image-uploader-container" class="hidden">
                    <label for="bg-image-file" class="block text-sm font-medium text-gray-700 mb-2">Upload Background Image:</label>
                    <input type="file" id="bg-image-file" accept="image/*" class="mt-1 block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100 transition-colors duration-200">
                </div>
            </div>

            <div class="image-container">
                <img id="generated-image" src="" alt="Generated Image">
                <canvas id="text-canvas" class="hidden"></canvas>
                <div id="loading" class="loading-spinner"></div>
                <div id="placeholder" class="p-8 text-center text-gray-500 text-lg">Enter your text and click 'Generate Image'</div>
                <div id="error-message" class="message-box hidden"></div>
            </div>

            <div class="flex flex-col md:flex-row w-full space-y-4 md:space-y-0 md:space-x-4 justify-center">
                <button id="generate-button" 
                        class="w-full md:w-auto px-8 py-4 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform hover:scale-105">
                    Generate Image
                </button>
                <button id="download-button"
                        class="w-full md:w-auto px-8 py-4 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transform hover:scale-105 hidden">
                    <i class="fas fa-download mr-2"></i>Download Image
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const generateButton = document.getElementById('generate-button');
        const downloadButton = document.getElementById('download-button');
        const generatedImage = document.getElementById('generated-image');
        const loadingSpinner = document.getElementById('loading');
        const placeholder = document.getElementById('placeholder');
        const errorMessage = document.getElementById('error-message');
        const userInput = document.getElementById('user-input');
        const fontSelect = document.getElementById('font-family');
        const textColorInput = document.getElementById('text-color');
        const bgColorInput = document.getElementById('bg-color');
        const backgroundModeSelect = document.getElementById('background-mode');
        const colorPickerContainer = document.getElementById('color-picker-container');
        const imageUploaderContainer = document.getElementById('image-uploader-container');
        const bgImageFile = document.getElementById('bg-image-file');
        const textPlacementSelect = document.getElementById('text-placement');
        const textAlignSelect = document.getElementById('text-align');
        const imageDimensionsSelect = document.getElementById('image-dimensions');
        const textStyleSelect = document.getElementById('text-style');

        // Function to show/hide background options based on mode
        backgroundModeSelect.addEventListener('change', (e) => {
            if (e.target.value === 'color') {
                colorPickerContainer.classList.remove('hidden');
                imageUploaderContainer.classList.add('hidden');
            } else {
                colorPickerContainer.classList.add('hidden');
                imageUploaderContainer.classList.remove('hidden');
            }
        });
        
        // Function to show a message to the user
        const showMessage = (text, type = 'info') => {
            errorMessage.textContent = text;
            errorMessage.className = `message-box ${type === 'error' ? 'text-red-600' : 'text-gray-700'}`;
            errorMessage.style.display = 'block';
            placeholder.style.display = 'none';
        };

        const hideMessage = () => {
            errorMessage.style.display = 'none';
            placeholder.style.display = 'block';
        };

        // Function to wrap text on the canvas
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let lines = [];
            
            for(let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let metrics = context.measureText(testLine);
                let testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    lines.push(line);
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);
            
            for (let i = 0; i < lines.length; i++) {
                context.fillText(lines[i], x, y + i * lineHeight);
            }
        }

        // Function to handle the image generation process using a canvas
        const generateImage = () => {
            const userPrompt = userInput.value.trim();

            if (!userPrompt) {
                showMessage('Please enter text to generate an image.', 'error');
                return;
            }

            // Hide previous image, download button, and show loading spinner
            generatedImage.style.display = 'none';
            downloadButton.style.display = 'none';
            loadingSpinner.style.display = 'block';
            hideMessage();
            showMessage('Generating image...', 'info');
            generateButton.disabled = true;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            let width, height;
            const dimensions = imageDimensionsSelect.value;
            
            if (dimensions === '1080x1350') {
                width = 1080;
                height = 1350;
            } else { // 'default' or 'fit-to-image'
                width = 640;
                height = 480;
            }
            canvas.width = width;
            canvas.height = height;

            const drawTextOnCanvas = (canvasWidth, canvasHeight) => {
                // Determine font properties based on text style
                const textStyle = textStyleSelect.value;
                let fontSize, fontWeight, lineHeight;
                
                switch (textStyle) {
                    case 'heading':
                        fontSize = 50;
                        fontWeight = 'bold';
                        lineHeight = 60;
                        break;
                    case 'subheading':
                        fontSize = 40;
                        fontWeight = 'bold';
                        lineHeight = 50;
                        break;
                    case 'paragraph':
                    default:
                        fontSize = 30;
                        fontWeight = 'normal';
                        lineHeight = 40;
                        break;
                }

                // Set text properties from user inputs
                ctx.fillStyle = textColorInput.value;
                const fontFamily = fontSelect.value;
                ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;

                // Set horizontal alignment
                const textAlign = textAlignSelect.value;
                ctx.textAlign = textAlign;
                let textX;
                if (textAlign === 'left') {
                    textX = 40;
                } else if (textAlign === 'right') {
                    textX = canvasWidth - 40;
                } else { // center
                    textX = canvasWidth / 2;
                }
                
                // Recalculate text for accurate line breaks
                const textLines = userPrompt.split('\n');
                const totalHeight = textLines.length * lineHeight;
                
                // Set vertical placement
                let textY;
                const textPlacement = textPlacementSelect.value;
                
                // Adjust textY based on placement and total height
                if (textPlacement === 'top') {
                    textY = 40;
                } else if (textPlacement === 'bottom') {
                    textY = canvasHeight - totalHeight - 10;
                } else { // middle
                    textY = (canvasHeight - totalHeight) / 2;
                }
                
                // Draw each line of text
                ctx.textBaseline = 'top';
                for (let i = 0; i < textLines.length; i++) {
                    const line = textLines[i];
                    wrapText(ctx, line, textX, textY + i * lineHeight, canvasWidth - 80, lineHeight);
                }

                // Convert canvas to image and update the DOM
                const imageUrl = canvas.toDataURL('image/png');
                generatedImage.src = imageUrl;
                generatedImage.style.display = 'block';
                downloadButton.style.display = 'block';
                hideMessage();
                
                loadingSpinner.style.display = 'none';
                generateButton.disabled = false;
            };

            // Draw background based on mode
            const backgroundMode = backgroundModeSelect.value;
            if (backgroundMode === 'color') {
                ctx.fillStyle = bgColorInput.value;
                ctx.fillRect(0, 0, width, height);
                drawTextOnCanvas(width, height);
            } else if (backgroundMode === 'image') {
                const file = bgImageFile.files[0];
                if (!file) {
                    showMessage('Please upload a background image file.', 'error');
                    loadingSpinner.style.display = 'none';
                    generateButton.disabled = false;
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        let finalWidth, finalHeight;
                        if (dimensions === 'fit-to-image') {
                            finalWidth = img.width;
                            finalHeight = img.height;
                            canvas.width = finalWidth;
                            canvas.height = finalHeight;
                        } else {
                            finalWidth = width;
                            finalHeight = height;
                        }

                        // Draw the image to cover the canvas without stretching
                        const hRatio = finalWidth / img.width;
                        const vRatio = finalHeight / img.height;
                        const ratio = Math.max(hRatio, vRatio);
                        const centerShiftX = (finalWidth - img.width * ratio) / 2;
                        const centerShiftY = (finalHeight - img.height * ratio) / 2;
                        ctx.drawImage(img, 0, 0, img.width, img.height, centerShiftX, centerShiftY, img.width * ratio, img.height * ratio);
                        
                        drawTextOnCanvas(finalWidth, finalHeight);
                    };
                    img.onerror = function() {
                        showMessage('Error loading the uploaded image. Please try a different file.', 'error');
                        loadingSpinner.style.display = 'none';
                        generateButton.disabled = false;
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
        
        // Function to download the generated image
        const downloadImage = () => {
            const imageUrl = generatedImage.src;
            if (imageUrl) {
                const link = document.createElement('a');
                link.href = imageUrl;
                link.download = 'generated-image.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        };

        // Add event listeners to the buttons
        generateButton.addEventListener('click', generateImage);
        downloadButton.addEventListener('click', downloadImage);
    </script>
</body>
</html>
